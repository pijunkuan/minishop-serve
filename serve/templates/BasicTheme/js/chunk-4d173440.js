(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4d173440"],{"2f94":function(t,e,s){"use strict";s.d(e,"d",(function(){return i})),s.d(e,"a",(function(){return a})),s.d(e,"c",(function(){return n})),s.d(e,"b",(function(){return o}));var d=s("b775");function i(t){return Object(d["a"])({url:"address",method:"get",params:t})}function a(t){return Object(d["a"])({url:"address",method:"post",data:t})}function n(t,e){return Object(d["a"])({url:"address/"+t,method:"put",data:e})}function o(t){return Object(d["a"])({url:"address/"+t,method:"delete"})}},9240:function(t,e,s){},"99af":function(t,e,s){"use strict";var d=s("23e7"),i=s("d039"),a=s("e8b5"),n=s("861d"),o=s("7b0b"),r=s("50c4"),c=s("8418"),l=s("65f0"),u=s("1dde"),h=s("b622"),v=s("2d00"),p=h("isConcatSpreadable"),m=9007199254740991,f="Maximum allowed index exceeded",_=v>=51||!i((function(){var t=[];return t[p]=!1,t.concat()[0]!==t})),b=u("concat"),g=function(t){if(!n(t))return!1;var e=t[p];return void 0!==e?!!e:a(t)},k=!_||!b;d({target:"Array",proto:!0,forced:k},{concat:function(t){var e,s,d,i,a,n=o(this),u=l(n,0),h=0;for(e=-1,d=arguments.length;e<d;e++)if(a=-1===e?n:arguments[e],g(a)){if(i=r(a.length),h+i>m)throw TypeError(f);for(s=0;s<i;s++,h++)s in a&&c(u,h,a[s])}else{if(h>=m)throw TypeError(f);c(u,h++,a)}return u.length=h,u}})},aa69:function(t,e,s){"use strict";s.r(e);var d=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("page-loading",{attrs:{loading:t.loading}}),s("div",{staticStyle:{"overflow-y":"scroll"},style:{height:t.height+"px"}},[s("div",{staticClass:"checkout-address"},[s("div",{staticClass:"checkout-address-icon"},[s("shop-icon",{attrs:{name:"ditu",size:"small"}})],1),t.address?s("div",{staticClass:"checkout-address-info"},[s("div",[t._m(0),s("div",[t._v(t._s(t.address.name))])]),s("div",[t._m(1),s("div",[t._v(t._s(t.address.mobile))])]),s("div",[t._m(2),s("div",[t._v(t._s(t.address.province+" "+t.address.city+" "+t.address.district+" "+t.address.detail))])])]):t._e(),s("div",{staticClass:"checkout-address-button",class:{"has-address":t.address}},[t.address?s("span",{on:{click:t.toEdit}},[t._v("修改地址")]):t._e(),t.address?s("span",{on:{click:t.toChange}},[t._v("更换地址")]):t._e(),s("span",{on:{click:t.toAdd}},[t._v("新增地址")])])]),s("div",{staticClass:"checkout-item-list"},t._l(t.items,(function(e,d){return s("div",{key:d,staticClass:"checkout-item-list-item"},[s("div",[s("shop-image",{attrs:{src:e.img_url,width:100,type:"stretch",rounded:""}},[s("div",{staticClass:"item-image-placeholder",attrs:{slot:"error"},slot:"error"}),s("div",{staticClass:"item-image-placeholder",attrs:{slot:"placeholder"},slot:"placeholder"})])],1),s("div",[s("div",{staticClass:"checkout-item-list-item__title"},[t._v(t._s(e.product_title)+" ")]),s("div",{staticClass:"checkout-item-list-item__subtitle"},[t._v(t._s(e.variant_title))]),s("div",{staticClass:"checkout-item-list-item__price"},[t._v("¥ "),s("strong",[t._v(t._s(e.price))])]),s("div",{staticClass:"checkout-item-list-item__amount"},[t._v("x "+t._s(e.quantity))])])])})),0),s("div",{staticClass:"remark-info"},[s("div",[t._v("留言")]),s("shop-input",{attrs:{size:"small",placeholder:"给我们留言",rounded:!1},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1),s("div",{staticClass:"detail-info"},[s("div",[s("div",[t._v("商品费用：")]),s("div",[t._v("¥ "),s("strong",[t._v(t._s(t.total.items_amount))])])]),s("div",[s("div",[t._v("运输费用：")]),s("div",[t._v("¥ "),s("strong",[t._v(t._s(t.total.shipments_amount))])])]),s("div",[s("div",[t._v("优惠费用：")]),s("div",[t._v("¥ "),s("strong",[t._v(t._s(t.total.discounts_amount))])])])])]),s("div",{staticClass:"checkout-footer"},[s("div",[t._v(" 总计："),s("span",[t._v("¥ "),s("strong",[t._v(t._s(t.total.amount?t.total.amount:"-"))])])]),s("div",[s("shop-button",{attrs:{rounded:!1,disabled:t.btnLoading},on:{click:t.createOrder}},[t._v("提交订单")])],1)]),s("shop-popup",{attrs:{show:t.addShow,full:""}},[s("div",{attrs:{slot:"title"},slot:"title"},[t._v(t._s("edit"===t.editType?"编辑地址":"新增地址"))]),s("div",{staticClass:"add-popup-content",attrs:{slot:"content"},slot:"content"},[s("div",[s("div",[t._v("收件人")]),s("shop-input",{attrs:{rounded:!1},model:{value:t.editAddress.name,callback:function(e){t.$set(t.editAddress,"name",e)},expression:"editAddress.name"}})],1),s("div",[s("div",[t._v("联系方式")]),s("shop-input",{attrs:{rounded:!1},model:{value:t.editAddress.mobile,callback:function(e){t.$set(t.editAddress,"mobile",e)},expression:"editAddress.mobile"}})],1),s("div",[s("div",[t._v("省市区")]),s("shop-dispicker",{attrs:{value:t.editAddress.dispicker},on:{change:t.selectDispicker}})],1),s("div",[s("div",[t._v("邮政编码")]),s("shop-input",{attrs:{rounded:!1},model:{value:t.editAddress.zip,callback:function(e){t.$set(t.editAddress,"zip",e)},expression:"editAddress.zip"}})],1),s("div",[s("div",[t._v("详细地址")]),s("shop-input",{attrs:{rounded:!1},model:{value:t.editAddress.detail,callback:function(e){t.$set(t.editAddress,"detail",e)},expression:"editAddress.detail"}})],1)]),s("div",{attrs:{slot:"button"},slot:"button"},[s("div",{staticClass:"add-popup-button"},[s("shop-button",{attrs:{type:"border",rounded:!1},on:{click:t.closeAdd}},[t._v("关闭")])],1),s("div",{staticClass:"add-popup-button"},[s("shop-button",{attrs:{rounded:!1},on:{click:t.confirmAdd}},[t._v("确认")])],1)])]),s("shop-popup",{attrs:{show:t.selectShow,full:""}},[s("div",{attrs:{slot:"title"},slot:"title"},[t._v("地址簿")]),s("div",{staticClass:"add-popup-content",attrs:{slot:"content"},slot:"content"},[s("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.getAddress,expression:"getAddress"}],staticClass:"address-list",style:{height:t.popheight+"px"},attrs:{"infinite-scroll-disabled":"adisabled","infinite-scroll-distance":"10","infinite-scroll-immediate-check":""}},[t._l(t.addresses,(function(e,d){return s("li",{key:d},[s("shop-radio",{staticClass:"address-radio",attrs:{label:e},model:{value:t.selectAddress,callback:function(e){t.selectAddress=e},expression:"selectAddress"}},[s("div")]),s("div",{staticClass:"address-content"},[s("div",[s("div",[t._v("收件人：")]),s("div",[t._v(t._s(e.name))])]),s("div",[s("div",[t._v("联系方式：")]),s("div",[t._v(t._s(e.mobile))])]),s("div",[s("div",[t._v("收件地址：")]),s("div",[t._v(t._s(e.province+" "+e.city+" "+e.district+" "+e.detail))])])])],1)})),t.nomore?t._e():s("div",{staticClass:"address-placeholder"},[t._v("加载中...")]),t.nomore?s("div",{staticClass:"address-placeholder"},[t._v("没有更多了")]):t._e()],2)]),s("div",{attrs:{slot:"button"},slot:"button"},[s("div",{staticClass:"add-popup-button"},[s("shop-button",{attrs:{type:"border",rounded:!1},on:{click:t.closeSelect}},[t._v("关闭")])],1),s("div",{staticClass:"add-popup-button"},[s("shop-button",{attrs:{rounded:!1},on:{click:t.confirmSelect}},[t._v("确认")])],1)])])],1)},i=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("strong",[t._v("收件人：")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("strong",[t._v("联系方式：")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("strong",[t._v("收货地址：")])])}],a=(s("99af"),s("d81d"),s("b0c0"),s("2166")),n=s("f8b7"),o=s("2f94"),r=s("76a0"),c={data:function(){return{loading:!1,address:null,items:[],total:{items_amount:0,shipments_amount:0,discounts_amount:0,amount:0},height:0,remark:"",addShow:!1,editType:"add",editAddress:{name:"",dispicker:[],address:"",mobile:"",zip:""},selectShow:!1,selectAddress:{},adisabled:!1,nomore:!1,aloading:!1,addresses:[],popheight:0,fetchQuery:{page:0,pageSize:15},btnLoading:!1}},created:function(){this.getItems()},methods:{getItems:function(){var t=this;this.loading=!0,Object(a["f"])(this.$route.query.key).then((function(e){t.fetchQuery.page=1,Object(o["d"])(t.fetchQuery).then((function(s){0!==s.data.body.data.length&&(t.address=s.data.body.data[0]);var d={address:t.address,items:e.data.body.items};t.calcTotal(d)}))})).catch((function(){t.loading=!1,Object(r["Toast"])({message:"订单已超时",duration:1e3}),setTimeout((function(){t.$router.push({name:"Cart",query:{from:"Checkout"}})}),1e3)}))},calcTotal:function(t){var e=this;Object(n["a"])(t).then((function(t){e.items=t.data.body.items,e.total.amount=t.data.body.amount,e.total.discounts_amount=t.data.body.discounts_amount,e.total.shipments_amount=t.data.body.shipments_amount,e.total.items_amount=t.data.body.items_amount,e.loading=!1})).catch((function(){e.loading=!1}))},closeAdd:function(){this.addShow=!1,this.editAddress={name:"",dispicker:[],address:"",detail:""}},toEdit:function(){this.addShow=!0,this.editAddress.id=this.address.id,this.editAddress.name=this.address.name,this.editAddress.mobile=this.address.mobile,this.editAddress.detail=this.address.detail,this.editAddress.zip=this.address.zip,this.editAddress.dispicker.push(this.address.province),this.editAddress.dispicker.push(this.address.city),this.editAddress.dispicker.push(this.address.district),this.editType="edit"},toAdd:function(){this.addShow=!0,this.editType="add"},toChange:function(){this.selectShow=!0},selectDispicker:function(t){this.editAddress.dispicker=t},getAddress:function(){var t=this;this.fetchQuery.page+=1,setTimeout((function(){Object(o["d"])(t.fetchQuery.page).then((function(e){0===e.data.body.data.length?(t.nomore=!0,t.adisabled=!0):(t.nomore=!1,t.adisabled=!1,t.addresses=t.addresses.concat(e.data.body.data))})).catch((function(){t.adisabled=!0,t.nomore=!0}))}),200)},confirmAdd:function(){var t=this,e={name:this.editAddress.name,province:this.editAddress.dispicker[0],city:this.editAddress.dispicker[1],district:this.editAddress.dispicker[2],detail:this.editAddress.detail,mobile:this.editAddress.mobile,zip:this.editAddress.zip},s={address:e,items:this.items};"edit"===this.editType?Object(o["c"])(this.editAddress.id,e).then((function(){t.address=e,t.address["id"]=t.editAddress.id,t.closeAdd(),t.loading=!0,t.calcTotal(s)})).catch((function(t){Object(r["Toast"])(t.response.data.message)})):Object(o["a"])(e).then((function(){t.closeAdd(),t.loading=!0,t.address=e,t.calcTotal(s)})).catch((function(t){Object(r["Toast"])(t.response.data.message)}))},closeSelect:function(){this.fetchQuery.page=0,this.selectShow=!1,this.selectAddress={}},confirmSelect:function(){this.address=this.selectAddress;var t={address:this.address,items:this.items};this.loading=!0,this.calcTotal(t),this.closeSelect()},createOrder:function(){var t=this;if(this.address){if(!this.btnLoading){this.btnLoading=!0;var e={address:this.address,items:[],remark:this.remark};this.items.map((function(t){var s={variant_id:t.variant_id,quantity:t.quantity};e.items.push(s)})),Object(n["c"])(e).then((function(e){t.$router.push({name:"Checkpay",query:{no:e.data.body.no}}),t.btnLoading=!1})).catch((function(){t.btnLoading=!1}))}}else Object(r["Toast"])("请添加地址再提交订单")}},mounted:function(){var t=this;this.$nextTick((function(){t.height=window.innerHeight-94,t.popheight=window.innerHeight-85})),window.onresize=function(){t.height=window.innerHeight-94,t.popheight=window.innerHeight-85}}},l=c,u=(s("aaef"),s("2877")),h=Object(u["a"])(l,d,i,!1,null,"0b797764",null);e["default"]=h.exports},aaef:function(t,e,s){"use strict";var d=s("9240"),i=s.n(d);i.a},f8b7:function(t,e,s){"use strict";s.d(e,"a",(function(){return i})),s.d(e,"c",(function(){return a})),s.d(e,"d",(function(){return n})),s.d(e,"f",(function(){return o})),s.d(e,"e",(function(){return r})),s.d(e,"b",(function(){return c}));var d=s("b775");function i(t){return Object(d["a"])({url:"order/calc",method:"post",data:t})}function a(t){return Object(d["a"])({url:"order",method:"post",data:t})}function n(t,e){return Object(d["a"])({url:"order/"+t+"/pay/"+e,method:"post"})}function o(t){return Object(d["a"])({url:"order",method:"get",params:t})}function r(t){return Object(d["a"])({url:"order/"+t,method:"get"})}function c(t,e){return Object(d["a"])({url:"order/"+t,method:"put",data:e})}}}]);